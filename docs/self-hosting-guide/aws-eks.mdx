---
title: 'AWS EKS Installation'
order: 72
---

## Self-Hosting Guide: AWS EKS Installation

AWS's Elastic Kubernetes Service (EKS) is a managed service that lets you deploy, manage, and scale containerized applications on Kubernetes.

In this guide, you will install Yorkie cluster on AWS EKS using Helm.
Then, you will test Yorkie cluster with a CodePair, a collaborative code editor.

### Prerequities

This tutorial assumes that you are familiar with Kubernetes and `kubectl`.

For this tutorial, you will need:

- [kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl/) v1.2.40+.
- [Helm](https://helm.sh/docs/intro/install/) v3.0+.
- [istioctl](https://istio.io/latest/docs/setup/getting-started/#download) v1.17+, installed on your machine.

### Setup AWS EKS cluster

To install Yorkie cluster on AWS EKS, you need to provision AWS EKS cluster first.
Also, you need to install EBS CSI driver and ALB ingress controller to dynamically provision EBS volumes and ALB ingress resources.

If you did not provision AWS EKS, see [Getting Started with Amazon EKS](https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html).
Also, if you did not install EBS CSI driver and ALB ingress controller, see [EBS CSI Driver](https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html) and [ALB Ingress Controller](https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html).

You can also provision AWS EKS with Terraform. Follow [Provision an EKS Cluster (AWS) Tutorial](https://developer.hashicorp.com/terraform/tutorials/kubernetes/eks#verify-the-cluster) for more details.

After provisioning AWS EKS cluster, verify that the cluster is ready:

```
$ kubectl cluster-info
Kubernetes control plane is running at https://12341234123412341234.gr7.ap-northeast-2.eks.amazonaws.com
CoreDNS is running at https://12341234123412341234.gr7.ap-northeast-2.eks.amazonaws.com/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'. 
```

### Install Istio with istioctl

After AWS EKS is configured, install Istio with the following command:

```
$ istioctl install -f <(curl -s https://raw.githubusercontent.com/yorkie-team/yorkie/main/build/charts/yorkie-cluster/istio-operator.yaml)
```

This will install Istio with [Istio Operator](https://istio.io/latest/docs/setup/install/operator/) configuration file.
You can find the configuration file [here](https://raw.githubusercontent.com/yorkie-team/yorkie/main/build/charts/yorkie-cluster/istio-operator.yaml).

When installing Istio, you will see the following output:

```
This will install the Istio 1.17.1 default profile with ["Istio core" "Istiod" "Ingress gateways"] components into the cluster. Proceed? (y/N)
```

Type `y` and press `Enter` to continue.

After Istio is installed, you will see the following output:

```
✔ Istio core installed
✔ Istiod installed
✔ Ingress gateways installed
✔ Installation complete                                                                                             
Making this installation the default for injection and validation.

Thank you for installing Istio 1.17.  Please take a few minutes to tell us about your install/upgrade experience!  https://forms.gle/hMHGiwZHPU7UQRWe9
```

### Add yorkie-team Helm chart in your local repository

After Istio is installed, add yorkie-team Helm chart repository in your local repository with the following command:

```
$ helm repo add yorkie-team https://yorkie-team.github.io/yorkie/helm-charts
```

Then, update your local repository with the following command:

```
$ helm repo update
```

### Install Yorkie cluster with Helm chart

After yorkie-team Helm chart repository is added, install Yorkie cluster with the following command:

```
$ helm install yorkie-cluster yorkie-team/yorkie-cluster  \
	  --set ingress.ingressClassName=alb \
	  --set ingress.hosts.enabled=true \
    --set ingress.hosts.apiHost={YOUR_API_DOMAIN_NAME} \
    --set ingress.hosts.adminHost={YOUR_ADMIN_DOMAIN_NAME} \
    --set ingress.alb.enabled=true \
    --set ingress.alb.certArn={YOUR_CERTIFICATE_ARN}
```

Replace `{YOUR_API_DOMAIN_NAME}` and `{YOUR_ADMIN_DOMAIN_NAME}` with your domain name.
Also, replace `{YOUR_CERTIFICATE_ARN}` with your certificate ARN.

If you did not provision domain name, follow [Registering a domain name](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-register.html).
If you did not provision certificate, follow [Requesting a public certificate](https://docs.aws.amazon.com/acm/latest/userguide/gs-acm-request-public.html).

This will install `yorkie-cluster` release in AWS EKS, which can publicly accessible via `{YOUR_API_DOMAIN_NAME}` and `{YOUR_ADMIN_DOMAIN_NAME}`.

After Yorkie cluster is installed, you will see the following output:

```
NAME: yorkie-cluster
LAST DEPLOYED: Thu Apr 27 21:49:06 2023
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
--- Install Complete ---
yorkie-cluster successfully installed!

For next steps, follow:
  $ curl https://github.com/yorkie-team/yorkie/tree/main/charts/yorkie-cluster

To learn more about the release, try:
  $ helm status yorkie-cluster
  $ helm get all yorkie-cluster
```

Now you have Yorkie cluster installed in AWS EKS.
It will take a few minutes for pods to be ready, so wait until all pods are ready.
You can check the status of pods with the following command:

```
$ kubectl get pods -n yorkie --watch
```

After all pods are ready, you will see the following output:

```
NAME                      READY   STATUS    RESTARTS      AGE
mongodb-0                 1/1     Running   0             76s
yorkie-74969cc796-46s47   1/1     Running   2 (54s ago)   76s
yorkie-74969cc796-c8zpt   1/1     Running   2 (50s ago)   76s
yorkie-74969cc796-n9jtr   1/1     Running   2 (52s ago)   76s
```

### Test Yorkie cluster

Now that you have Yorkie cluster installed and exposed, you can test Yorkie cluster with CodePair, which is a collaborative editing tool.

Here, we will use [CodePair](https://github.com/yorkie-team/codepair).
Clone CodePair repository with the following command:

```
$ git clone https://github.com/yorkie-team/codepair
```

Then, install dependencies with the following command:

```
$ cd codepair
$ npm install
```

After dependencies are installed, change `VITE_APP_YORKIE_RPC_ADDR` in `.env.development` file to API Domain of Yorkie cluster you have configured above.

```
$ vi .env.development

VITE_APP_YORKIE_RPC_ADDR=http://{YOUR_API_DOMAIN_NAME}
```

Then, start CodePair with the following command:

```
$ npm run dev
```

You can open another web browser and access `http://localhost:3000` to test collaborative editing with CodePair.

### Clean up Yorkie cluster

You have now installed Yorkie cluster in AWS EKS, and tested collaborative editing with CodePair.

To learn about how to configure Yorkie Cluster in Helm Chart, see [Yorkie Cluster Helm Chart Repository](https://github.com/yorkie-team/yorkie/tree/main/build/charts/yorkie-cluster).

First, uninstall Yorkie cluster with the following command:

```
$ helm uninstall yorkie-cluster
release "yorkie-cluster" uninstalled
```

Then Uninstall Istio with the following command:

```
$ istioctl uninstall --purge
All Istio resources will be pruned from the cluster
Proceed? (y/N) y
...
✔ Uninstall complete
```

Then, delete EKS cluster via AWS Console or AWS CLI.

```
# AWS Console
$ https://{YOUR_REGION}.console.aws.amazon.com/eks/home?region={YOUR_REGION}#/clusters

# AWS CLI
$ aws eks delete-cluster --name {YOUR_CLUSTER_NAME}
```

### Next Steps

You can also install Yorkie Cluster Addons to monitor metrics and perform GitOps on Yorkie cluster.

For more information, see [Self-Hosting Guide: Cluster Addons Installation](/docs/self-hosting-guide/cluster-addons).
For more information about Yorkie cluster design, follow: [Yorkie Cluster Design](https://github.com/yorkie-team/yorkie/blob/main/design/sharded-cluster-mode.md)
